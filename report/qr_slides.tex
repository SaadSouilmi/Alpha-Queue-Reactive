\documentclass[aspectratio=169]{beamer}

\usetheme{metropolis}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb}
\usepackage{graphicx}
\usepackage{booktabs}

\title{Queue Reactive}
\date{}

\begin{document}

\begin{frame}
    \titlepage
\end{frame}

%==============================================================================
\section{Queue Reactive Model}
%==============================================================================

\begin{frame}{State Space}
    Project LOB onto $(\text{Imb}, n)$:
    \begin{equation*}
        \text{Imb} = \frac{Q^B - Q^A}{Q^B + Q^A}, \quad n = \text{spread (ticks)}
    \end{equation*}

    \vspace{1em}

    Events $\mathcal{E}$: Limit $(L)$, Cancel $(C)$, Trade $(T)$, Add-in-spread $(+)$

    \vspace{0.5em}
    Each with side (B/A) and level.
\end{frame}

\begin{frame}{Dynamics}
    \begin{equation*}
        \Delta t \sim \text{Exp}(\Lambda(\text{Imb}, n)), \quad e^* \sim \text{Cat}(q^1, \ldots, q^{|\mathcal{E}|})
    \end{equation*}

    where $\Lambda = \sum_e \lambda^e$ and $q^e = \lambda^e / \Lambda$.

    \vspace{1em}

    \textbf{Estimation:}
    \begin{equation*}
        \hat{\Lambda} = \left( \frac{1}{N} \sum_{k} \Delta t_k \right)^{-1}, \quad \hat{q}^e = \frac{N^e}{N}
    \end{equation*}
\end{frame}

\begin{frame}{Total Level Extension}
    \begin{columns}
        \begin{column}{0.5\textwidth}
            $Q^B = 1, Q^A = 1 \Rightarrow \text{Imb} = 0$\\[0.3em]
            {\small Thin book -- fragile}
        \end{column}
        \begin{column}{0.5\textwidth}
            $Q^B = 50, Q^A = 50 \Rightarrow \text{Imb} = 0$\\[0.3em]
            {\small Thick book -- stable}
        \end{column}
    \end{columns}

    \vspace{1em}

    Extend state: $(\text{Imb}, n, \ell)$ where $\ell = Q^B + Q^A$ (bucketed).
\end{frame}

\begin{frame}{Setup}
    \begin{itemize}
        \item 11 imbalance bins (including 0)
        \item Levels 1--2, spread $n=1$ only
        \item Volumes bucketed by median size
        \item Data: Databento L2, 30min trimmed
    \end{itemize}
\end{frame}

%==============================================================================
\section{Results}
%==============================================================================

\begin{frame}{$\Delta t$: Exponential Fails}
    \begin{figure}
        \centering
        \includegraphics[width=0.7\textwidth]{figures/dt_distribution_emp_vs_qr_exp.pdf}
    \end{figure}
\end{frame}

\begin{frame}{$\Delta t$: GMM Fix}
    Fit GMM on $\log(\Delta t)$ per state.

    \begin{figure}
        \centering
        \includegraphics[width=0.7\textwidth]{figures/dt_distribution_emp_vs_qr_gmm.pdf}
    \end{figure}
\end{frame}

\begin{frame}{Event Types}
    \begin{figure}
        \centering
        \includegraphics[width=0.8\textwidth]{figures/event_type_distribution_emp_vs_qr.pdf}
    \end{figure}
\end{frame}

\begin{frame}{Imbalance}
    \begin{figure}
        \centering
        \includegraphics[width=0.8\textwidth]{figures/imbalance_distribution_emp_vs_qr.pdf}
    \end{figure}
\end{frame}

\begin{frame}{Spread Before Trades}
    \begin{figure}
        \centering
        \includegraphics[width=0.8\textwidth]{figures/spread_distribution_before_trades_emp_vs_qr.pdf}
    \end{figure}
\end{frame}

\begin{frame}{Queue Sizes}
    \begin{figure}
        \centering
        \includegraphics[width=0.8\textwidth]{figures/queue_size_distribution_emp_vs_qr.pdf}
    \end{figure}
\end{frame}

\begin{frame}{Daily Events}
    \begin{figure}
        \centering
        \includegraphics[width=0.8\textwidth]{figures/nb_daily_events_distribution_emp_vs_qr.pdf}
    \end{figure}
\end{frame}

\begin{frame}{Hourly Volume}
    \begin{figure}
        \centering
        \includegraphics[width=0.8\textwidth]{figures/hourly_traded_volume_distribution_emp_vs_qr.pdf}
    \end{figure}
\end{frame}

\begin{frame}{Daily Volatility}
    \begin{equation*}
        \sigma_{\text{day}} = \sqrt{\frac{1}{H - 1} \sum_{t} (p_{t+1} - p_t)^2}
    \end{equation*}
    5-min bins, $H = 5.5$ hours.

    \begin{figure}
        \centering
        \includegraphics[width=0.6\textwidth]{figures/5min_vol_daily_distribution_emp_vs_qr.pdf}
    \end{figure}
\end{frame}

\begin{frame}{Eta ($\eta$)}
    \begin{equation*}
        \eta = \frac{N_{\text{cont}}}{2 N_{\text{alt}}}
    \end{equation*}
    Measures price continuation vs alternation.

    \begin{figure}
        \centering
        \includegraphics[width=0.6\textwidth]{figures/eta_distribution_emp_vs_qr.pdf}
    \end{figure}
\end{frame}

%==============================================================================
\section{Market Impact}
%==============================================================================

\begin{frame}{Standard QR: No Impact}
    \begin{itemize}
        \item Symmetric: $P(\text{bid}) = P(\text{ask})$ at same imbalance
        \item No persistent drift $\Rightarrow$ no impact decay
    \end{itemize}

    \begin{figure}
        \centering
        \includegraphics[width=0.75\textwidth]{figures/no_impact_metaorder.pdf}
    \end{figure}
\end{frame}

\begin{frame}{EMA Impact Model}
    Track trade sign EMA:
    \begin{equation*}
        \phi_t = \alpha \cdot \xi_{\text{last}} + (1 - \alpha) \cdot \phi_{t-1}
    \end{equation*}

    Bias probabilities:
    \begin{equation*}
        P(\text{bid}) \propto P_0(\text{bid}) \cdot e^{m \phi_t}, \quad
        P(\text{ask}) \propto P_0(\text{ask}) \cdot e^{-m \phi_t}
    \end{equation*}

    $\phi_t > 0$ (buy pressure) $\Rightarrow$ more bids, fewer asks $\Rightarrow$ mean reversion.
\end{frame}

\begin{frame}{EMA Impact: Result}
    \begin{figure}
        \centering
        \includegraphics[width=0.85\textwidth]{figures/ema_impact_metaorder.pdf}
    \end{figure}

    Metaorder: 5\% hourly vol over 5min. 100k paths, 60min sim.
\end{frame}

%==============================================================================
\section{Signals}
%==============================================================================

\begin{frame}{Signal Biasing}
    Exogenous signal $\alpha_t$: $\alpha > 0$ predicts price up, $\alpha < 0$ predicts down.

    \vspace{0.5em}

    Combined bias (impact + signal):
    \begin{equation*}
        P(\text{bid}) \propto e^{\phi_t - \alpha_t}, \quad
        P(\text{ask}) \propto e^{-\phi_t + \alpha_t}
    \end{equation*}

    \vspace{0.5em}

    Predictivity: $\mathbb{E}[\alpha_t \cdot (P_{t+\Delta t} - P_t)]$

    \vspace{0.5em}

    OU process: $d\alpha_t = -\kappa \alpha_t \, dt + \sigma \, dW_t$, $\kappa = 0.5$ min$^{-1}$ (fades in $\sim$5min).
\end{frame}

%==============================================================================
\section{Round-Trip Time}
%==============================================================================

\begin{frame}{Round-Trip Time}
    \begin{figure}
        \centering
        \includegraphics[width=0.75\textwidth]{../figures/dt_hist.png}
    \end{figure}

    Mode at $\log_{10}(\Delta t) \approx 4.47$ $\Rightarrow$ \textbf{29$\mu$s}.
\end{frame}

\begin{frame}{Peak Region}
    \begin{figure}
        \centering
        \includegraphics[width=0.75\textwidth]{../figures/dt_hist_zoomed.png}
    \end{figure}

    50\% density bounds: $[4.39, 4.55]$ $\Rightarrow$ $[24\mu s, 35\mu s]$.
\end{frame}

\begin{frame}{Peak Fit}
    \begin{figure}
        \centering
        \includegraphics[width=0.7\textwidth]{../figures/peak_fit.png}
    \end{figure}

    $\delta$ = round-trip time. Gaussian fit: $\mu = 4.471$, $\sigma = 0.040$.
\end{frame}

\begin{frame}{QR Inter-Event Times}
    QR = reactions to LOB $\Rightarrow$ $\Delta t \geq \delta$ + reaction time.

    Fit GMM to peak and beyond (exclude left tail).

    \begin{figure}
        \centering
        \includegraphics[width=0.9\textwidth]{../figures/mixture_fit.png}
    \end{figure}
\end{frame}

%==============================================================================
\section{Race Mechanism}
%==============================================================================

\begin{frame}{What Are Races?}
    Left tail ($< 29\mu$s): bursts of aggressive orders following signal $\alpha$.

    \begin{itemize}
        \item $\alpha > 0$: racers target ask (buy)
        \item $\alpha < 0$: racers target bid (sell)
    \end{itemize}
\end{frame}

\begin{frame}{Race Triggering}
    \begin{figure}
        \centering
        \includegraphics[width=0.9\textwidth]{../figures/race_proba_nb.png}
    \end{figure}

    $P(\text{race}|\alpha) = \frac{1}{1 + e^{-8(|\alpha| - 0.7)}}$ for $|\alpha| \geq 0.8$, \quad $\mathbb{E}[N|\alpha] = 4 + 2.5(|\alpha| - 0.7)$
\end{frame}

\begin{frame}{Race Composition \& Timing}
    \textbf{Composition (base):} 45\% trades, 30\% limits, 25\% cancels

    As $|\alpha| \uparrow$: limits $\downarrow$, freed $\to$ 60\% trades + 40\% cancels.

    \vspace{0.5em}

    \textbf{Timing:} First racer at $t_0 + \delta$, then $\gamma_i \sim$ Weibull.

    \begin{figure}
        \centering
        \includegraphics[width=0.85\textwidth]{../figures/tail_fit.png}
    \end{figure}
\end{frame}

\begin{frame}{Race Consumption}
    \textbf{Problem:} Race completes in $\mu$s, but $\alpha$ decays over minutes.

    $\Rightarrow$ After race, $\alpha$ still above threshold $\Rightarrow$ endless races.

    \vspace{1em}

    \textbf{Solution:} Each race consumes fraction $\theta$ of signal:
    \begin{equation*}
        \alpha \leftarrow (1 - \theta) \cdot \alpha
    \end{equation*}

    \begin{figure}
        \centering
        \includegraphics[width=0.6\textwidth]{figures/alpha_decay.pdf}
    \end{figure}
\end{frame}

\end{document}
